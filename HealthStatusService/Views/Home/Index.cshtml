@model List<HealthStatusService.Models.HealthStatusViewModel>

@{
    ViewBag.Title = "Health Status";
}

<h2>Health Status za poslednja 2 sata</h2>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
}

@foreach (var service in Model)
{
    <div class="card mb-4">
        <div class="card-header">
            <strong>@service.ServiceName</strong> - Uptime: @service.UptimePercentage.ToString("F2")%
        </div>
        <div class="card-body">
            <canvas id="chart_@service.ServiceName.Replace(" ", "_")" height="150"></canvas>

            <script>
                var ctx = document.getElementById('chart_@service.ServiceName.Replace(" ", "_")').getContext('2d');
                var labels = [@string.Join(",", service.Records.Select(r => "'" + r.TimestampUtc.ToLocalTime().ToString("HH:mm:ss") + "'"))];
                var data = [@string.Join(",", service.Records.Select(r => r.Status == "OK" ? 1 : 0))];

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Status (1=OK, 0=NOT_OK)',
                            data: data,
                            fill: false,
                            borderColor: 'rgb(75, 192, 192)',
                            tension: 0.1,
                            pointRadius: 5
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                suggestedMax: 1,
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        return value === 1 ? 'OK' : 'NOT_OK';
                                    }
                                }
                            }
                        }
                    }
                });
            </script>
        </div>
    </div>
}
